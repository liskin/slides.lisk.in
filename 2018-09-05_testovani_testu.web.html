<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Zonky QA Meetup ‚Äì Testov√°n√≠ test≈Ø</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/css/theme/sky.css" id="theme">
  <link rel="stylesheet" href="css/custom-sky.css"/>
  <link rel="stylesheet" href="css/custom-highlight.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/css/print/pdf.css' : 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Testov√°n√≠ test≈Ø</h1>
  <p class="author"><div class="line-block">Tom√°≈° Janou≈°ek<br />
(tools &amp; infra @ <a href="https://www.gooddata.com/company/careers-list">GoodData</a>)</div></p>
  <p class="date">5. 9. 2018 ‚Äî <a href="https://www.facebook.com/events/951789721691848/">Zonky QA Meetup</a></p>
</section>

<section><section id="intro" class="title-slide slide level1"><h1>Intro</h1></section><section id="proƒç" class="slide level2">
<h2>Proƒç?</h2>
<ul>
<li>k√≥d testujeme</li>
<li>testy jsou k√≥d</li>
<li>‚à¥ testy testujeme</li>
</ul>
</section><section id="a-co-infrastruktura" class="slide level2">
<h2>A co infrastruktura?</h2>
<ul>
<li>testovac√≠ infrastruktura je taky k√≥d</li>
<li>k√≥d testujeme</li>
<li>‚à¥ infrastrukturu testujeme</li>
</ul>
</section></section>
<section><section id="testov√°n√≠-test≈Ø-samotn√Ωch" class="title-slide slide level1"><h1>Testov√°n√≠ test≈Ø samotn√Ωch</h1></section><section id="za≈æijte-selh√°n√≠" class="slide level2">
<h2>Za≈æijte selh√°n√≠</h2>
<div class="smaller">
<blockquote>
<p>‚ÄúAfter you have written a test to detect a particular bug, <em>cause</em> the bug deliberately and make sure the test complains. This ensures that the test will catch the bug if it happens for real.‚Äù</p>
</blockquote>
<div class="line-block">The Pragmatic Programmer<br />
<span class="x-smaller">(Andrew Hunt and David Thomas, 2000)</span></div>
</div>
</section><section class="slide level2">

<pre class="diff"><code>@@ -544,6 +544,7 @@ class Jenkins(object):
 
   &quot;&quot;&quot;
   url = &#39;/&#39;.join((item, INFO)).lstrip(&#39;/&#39;)
+  url = quote(url)
   if query:
     url += query
   try:</code></pre>
<p><a href="https://git.openstack.org/cgit/openstack/python-jenkins/commit/?id=16007e01858cc5d36afdc31d22b5644f91a1f935">python-jenkins, git commit 16007e01</a></p>
</section><section class="slide level2">

<div class="smaller">
<pre class="python"><code data-noescape
>@patch.object(jenkins.Jenkins, 'jenkins_open')
def test_unsafe_chars(self, jenkins_mock):
  response = build_jobs_list_responses(
    self.jobs_in_unsafe_name_folders, 'http://example.com/')
  jenkins_mock.side_effect = iter(response)

  jobs_info = self.j.get_all_jobs()

  expected_fullnames = [
    u"my_job1", u"my_job2",
    u"my_folder1/my_job3", u"my_folder1/my_job4",
<span class="fragment highlight-mark">    u"my_folder1/my spaced folder/my job 5"</span>
  ]
  self.assertEqual(len(expected_fullnames), len(jobs_info))
<span class="fragment highlight-mark">  got_fullnames = [job[u"fullname"] for job in jobs_info]
  self.assertEqual(expected_fullnames, got_fullnames)</span>
</code></pre>
</div>
</section><section class="slide level2">

<div class="smaller">
<pre class="diff"><code>@@ -76,3 +98,11 @@ class JenkinsGetAllJobsTest(JenkinsGetJobsTestBase):
   self.assertEqual(len(expected_fullnames), len(jobs_info))
   got_fullnames = [job[u&quot;fullname&quot;] for job in jobs_info]
   self.assertEqual(expected_fullnames, got_fullnames)
+
+  expected_request_urls = [
+    self.make_url(&#39;api/json&#39;),
+    self.make_url(&#39;job/my_folder1/api/json&#39;),
+    self.make_url(&#39;job/my_folder1/job/my%20spaced%20folder/api/json&#39;)
+  ]
+  self.assertEqual(expected_request_urls,
+                   self.got_request_urls(jenkins_mock))</code></pre>
</div>
</section><section id="myslete-dlouhodobƒõ" class="slide level2">
<h2>Myslete dlouhodobƒõ</h2>
<ul>
<li>k√≥d se mƒõn√≠</li>
<li>testy zastar√°vaj√≠</li>
</ul>
</section><section id="code-coverage" class="slide level2">
<h2>Code coverage</h2>
<div class="smaller">
<blockquote>
<p>‚ÄúFor example, to have confidence in the testing of a program, we should want to know to what extent our tests actually covered the coding. [‚Ä¶] a record of those areas of coding that have and have not been executed in the course of running tests.‚Äù</p>
</blockquote>
<div class="line-block">The Psychology of Computer Programming<br />
<span class="x-smaller">(Gerald M. Weinberg, 1971)</span></div>
</div>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:30%;">
<p>mƒõ≈ô√≠me, kolik</p>
</div><div class="column" style="width:30%;">
<ul>
<li>soubor≈Ø</li>
<li>funkc√≠</li>
<li>≈ô√°dk≈Ø</li>
<li>vƒõtv√≠</li>
<li>podm√≠nek</li>
</ul>
</div><div class="column" style="width:40%;">
<p>m√°me pokryto testy</p>
</div>
</div>
</section><section class="slide level2">

<pre class="python"><code>def divisible_by_ten(n):
    if (n % 10 == 0):
        return True
    else:
        return false

def test_divisble_by_ten():
    assert divisible_by_ten(0)
    assert divisible_by_ten(10)
    assert divisible_by_ten(20)
    assert divisible_by_ten(100)</code></pre>
</section><section class="slide level2">

<img data-src="img/2018-09-05_testovani_testu/coverage.png" class="stretch" />
</section><section class="slide level2">

<p>(kolik z v√°s to pou≈æ√≠v√°?)</p>
<p>‚úã</p>
</section><section id="mutation-testing" class="slide level2">
<h2>Mutation testing</h2>
<ul>
<li>‚Äûopravdovƒõj≈°√≠‚Äú code coverage</li>
</ul>
</section><section class="slide level2">

<div class="smaller">
<blockquote>
<p>‚ÄúIf you are <em>really</em> serious about testing, you might want to appoint a <em>project saboteur</em>. The saboteur‚Äôs role is to take a separate copy of the source tree, introduce bugs on purpose, and verify that the tests will catch them.‚Äù</p>
</blockquote>
<div class="line-block">The Pragmatic Programmer<br />
<span class="x-smaller">(Andrew Hunt and David Thomas, 2000)</span></div>
</div>
</section><section class="slide level2">

<blockquote>
<p>‚ÄúOverconfidence by the programmer could be attacked by a system that introduced random errors into the program under test.‚Äù</p>
</blockquote>
<div class="line-block">The Psychology of Computer Programming<br />
<span class="smaller">(Gerald M. Weinberg, 1971)</span></div>
</section><section class="slide level2">

<div class="smaller">
<pre class="java"><code data-noescape
>import static org.junit.Assert.assertTrue;
import org.junit.Test;

public class AbsTest {
    private double abs(double x) {
        return x > 0 ? x : -x;
    }

    @Test public void absTest() {
        assertTrue(new Double(1.0d).equals(abs(1.0d)));
        assertTrue(new Double(1.0d).equals(abs(-1.0d)));
        <span class="fragment">assertTrue(new Double(0.0d).equals(abs(0.0d)));</span>
    }
}
</code></pre>
</div>
</section><section class="slide level2">

<p>(kolik z v√°s to pou≈æ√≠v√°?)</p>
<p>‚úã</p>
</section></section>
<section><section id="testov√°n√≠-testovac√≠-infrastruktury" class="title-slide slide level1"><h1>Testov√°n√≠ testovac√≠ infrastruktury</h1></section><section id="na≈°e-ci-infrastruktura" class="slide level2">
<h2>Na≈°e CI infrastruktura</h2>
<ul>
<li>‚Äûvelk√Ω‚Äú Jenkins</li>
<li>1500 job≈Ø z 500 ≈°ablon (<a href="https://docs.openstack.org/infra/jenkins-job-builder/">jenkins-job-builder</a>)</li>
<li>tis√≠ce build≈Ø dennƒõ</li>
<li>20k ≈ô√°dk≈Ø YAML≈Ø üí©</li>
</ul>
</section><section class="slide level2">

<div class="xx-smaller">
<div class="columns">
<div class="column">
<pre class="yaml"><code>- job-template:
    name: &#39;{folder}/delivery-promote-packages&#39;
    node: &#39;simple&#39;
    parameters:
      - choice:
          name: REPO_STAGE
          choices:
              - testing &gt; develop
              - develop &gt; release
              - release &gt; preprod
              - preprod &gt; master
      - text:
          name: REPOSITORIES
          default: ‚Ä¶
      - text:
          name: RPMS
          default: ALL
      - bool:
          name: DRY_RUN
      - text:
          name: BLACKLIST
    wrappers:
      - default-wrappers
      - workspace-cleanup
    builders:
      - checkout-ci-infra
      - shell: |
          ci-infra/‚Ä¶/bin/promote-packages.sh
      - promote-notification</code></pre>
</div><div class="column">
<pre class="yaml"><code>      - conditional-step:
          condition-kind: and
          condition-operands:
            - condition-kind: strings-match
              condition-string1: &#39;$REPO_STAGE&#39;
              condition-string2:
                &#39;develop &gt; release&#39;
            - condition-kind: strings-match
              condition-string1: &#39;$RPMS&#39;
              condition-string2: &#39;ALL&#39;
            - condition-kind: not
              condition-operand:
                condition-kind:
                  boolean-expression
                condition-expression: &#39;$DRY_RUN&#39;
          on-evaluation-failure: dont-run
          steps:
            - trigger-builds:
              - project:
                  &#39;{folder}/delivery-promote-packages&#39;
                predefined-parameters: |
                  REPO_STAGE=testing &gt; develop
                  REPOSITORIES=$REPOSITORIES
                  BLACKLIST=ipa.*
    publishers:
      - archive:
          artifacts: &#39;*.log&#39;
          allow-empty: &#39;true&#39;</code></pre>
</div>
</div>
</div>
</section><section class="slide level2">

<p>Jak chcete tohle refaktorovat?</p>
<p>ü§ï</p>
</section><section id="≈ôe≈°en√≠" class="slide level2">
<h2>≈òe≈°en√≠</h2>
<ul>
<li>vƒõt≈°ina logiky je v ‚ÄûExecute Shell‚Äú build kroc√≠ch</li>
<li>(ano, i spou≈°tƒõn√≠ mavenu/gradlu)</li>
<li>‚áí d√°me tam v≈°echnu a nap√≠≈°eme unit testy</li>
</ul>
</section><section id="cram" class="slide level2">
<h2>Cram</h2>
<blockquote>
<p>Cram is a functional testing framework for command line applications. Cram tests look like snippets of interactive shell sessions.</p>
</blockquote>
<p><a href="https://bitheap.org/cram/" class="uri">https://bitheap.org/cram/</a></p>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:35%;">
<pre class="rst"><code>my test case::

  $ A=1
  $ echo &quot;$A&quot;
  $ [[ $A == 2 ]]</code></pre>
</div><div class="column fragment" style="width:65%;">
<pre class="diff"><code>$ cram --shell=/bin/bash -i a.t
!
--- a.t
+++ a.t.err
@@ -2,4 +2,6 @@

   $ A=1
   $ echo &quot;$A&quot;
+  1
   $ [[ $A == 2 ]]
+  [1]
Accept this change? [yN] y
patching file a.t

# Ran 1 tests, 0 skipped, 1 failed.</code></pre>
</div>
</div>
</section><section class="slide level2">

<pre class="rst"><code>my finished test case::

  $ A=1
  $ echo &quot;$A&quot;
  1
  $ [[ $A == 2 ]]
  [1]</code></pre>
<pre class="text"><code>$ cram --shell=/bin/bash -i a.t
.
# Ran 1 tests, 0 skipped, 0 failed.</code></pre>
</section><section id="fake" class="slide level2">
<h2>fake</h2>
<blockquote>
<p>Fake is a small tool to create test doubles for commandline utilities.</p>
</blockquote>
<p><a href="https://github.com/roman-neuhauser/fake" class="uri">https://github.com/roman-neuhauser/fake</a></p>
</section><section class="slide level2">

<pre class="rst"><code>  $ . $TESTROOT/setup

  $ hostname -f
  laptop.example.com

  $ fake -o &lt;&lt;&lt;&#39;google.com&#39; hostname -f

  $ hostname -f
  google.com</code></pre>
</section><section class="slide level2">

<pre class="rst"><code>  $ . $TESTROOT/setup

  $ fake -o &lt;&lt;&lt;&#39;localhost&#39; hostname

  $ hostname -f
  fake: error: argv mismatch
  fake: expected: hostname
  fake: received: hostname -f
  [100]</code></pre>
</section><section class="slide level2">

<pre class="rst"><code>  $ . $TESTROOT/setup

  $ fake -c sleep

  $ sleep 1
  $ sleep 2
  $ sleep 5</code></pre>
</section><section class="slide level2">

<pre class="rst"><code>  $ . $TESTROOT/setup

  $ fake -b &lt;&lt;\EOF git clone \
  &gt;   git@github.com:gooddata/repo.git
  &gt; #!/bin/sh
  &gt; mkdir repo
  &gt; touch repo/file
  &gt; EOF

  $ git clone git@github.com:gooddata/repo.git
  $ find repo
  repo
  repo/file</code></pre>
</section><section id="bubblewrap" class="slide level2">
<h2>bubblewrap</h2>
<blockquote>
<p>Unprivileged sandboxing tool.</p>
</blockquote>
<p><a href="https://github.com/projectatomic/bubblewrap" class="uri">https://github.com/projectatomic/bubblewrap</a></p>
</section><section class="slide level2">

<pre class="shell"><code>$ bwrap \
  --unshare-all \
  --ro-bind / / \
  --proc /proc \
  --dev /dev \
  --tmpfs /tmp \
  rm -rf --no-preserve-root /</code></pre>
</section><section id="cram-fake-bwrap" class="slide level2">
<h2>cram + fake + bwrap</h2>
<p>üëç</p>
</section></section>
<section><section id="section" class="title-slide slide level1"><h1>üëã</h1></section><section class="slide level2">

<p><a href="https://store.lisk.in/slides" class="uri">https://store.lisk.in/slides</a></p>
</section></section>
    </div>
  </div>

  <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/lib/js/head.min.js"></script>
  <script src="https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'fast', // default/fast/slow
        // Parallax background image
        parallaxBackgroundImage: 'img/air-atmosphere-blue-675977.jpg', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"
        // Parallax background size
        parallaxBackgroundSize: '5392px 1588px', // CSS syntax, e.g. "2100px 900px"
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 800,
        height: 450,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/plugin/zoom-js/zoom.js', async: true },
          { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/plugin/notes/notes.js', async: true },
          { src: 'https://cdn.rawgit.com/hakimel/reveal.js/3.7.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        ]
      });
    </script>
    </body>
</html>
